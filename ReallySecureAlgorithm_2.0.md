# ReallySecureAlgorithm_2.0
## by Alexander Marx
### Task
Our task is to decrypt the ciphertext that was encrypted using a custom RSA algorithm

### Solution
When we run the client.py program we are given 4 different pieces of information: n_bits, e, N, and the ciphertext. Other than give us that information, the client program doesn't really do anything else. When we look at server.py we see that it has both an encrypt and a decrypt function. That means that if we get enough information we can run the decrypt function. Now our job is to figure out exactly what we need.

Looking in that function, we see that we need the ciphertext, N, d, and n_bits. We have everything except for d. Lets track down how d is calculated. We see that d is set to the line ```pow(self.e, -1, carmichael_N)```. We have e but we don't have carmichael_N. By looking for that value we see that it is assigned ```int((p-1)*(q-1)//GCD(p-1, q-1))```. We also see that ```N = p * q```. This means that we have to find the values of p and q. By looking through the algorithm, we see that p is set equal to a random value and then increased until it becomes prime. Then we see that q is set equal to p and then is also increased until it gets to a prime. This means that p and q are consecutive primes. This is the vulnerability to this challenge. Since N is p * q, if we square root N, the output will be in between p and q. Then we just need to increment and decrement that value until we hit the next prime to get the values of p and q.

Now that we have all values, we can just recreate each value and then plug them into the decrypt function to get the flag.

### Script
```python
import math
from Crypto.Util.Padding import pad, unpad
from Crypto.Util.number import GCD, isPrime
from Crypto.Random.random import getrandbits

N = 305396368758202685553476057109244406847455594872124380220441355680085770804583293833820768307631049208646562586723308418208993312935727259463608547630011613760062491798946991649844478094197173004007668789573139662550866412920745619468799473314561400403468099926335894671209252078776560374988433870516045564647528275087971143578348192304405166058748815733565683268623166743217756658480694506927525284696574662041316819912036153633554279507675651936272238176227333251017584025260495276388018929832134596209234836831233405049719288475260541112944682172537336282084205282578395790384955865575990779709266029182619411895323854976506875339801420381829080698482432297963534589102317431996227997920607717116553644665446908807575956679656097668573562347987035426707128820055412965514519320915180565595828883064042734563234795159820411163641280442530740586551582360780823031448843905780373230436693757743118744050739585492223712743749547600396108711538956559371770560549569788748088700702868985232757753613910966351953326526912945013626214588408714793109459955289272003485593440384650997870726601991534845808324632601820986699735465098301056925100222245523408667496956608601061986587205916247938369730998084166756460450768705024964863458844639
Nsqrt = math.isqrt(N)
p1 = Nsqrt
p2 = Nsqrt

while  True:
    if isPrime(p1):
        break
    p1 += 1

while  True:
    if isPrime(p2):
        break
    p2 -= 1

carmichael_N = int((p1-1)*(p2-1)//GCD(p1-1, p2-1))
e = 65537
d = pow(e, -1, carmichael_N)

ctxt = 74999382074714936590079489795446374658754800840841514453140540996925324295973226871495678357061133151241061400995235021836107128334292987104814820427370326062595157603321632977090386893556124407894117955646078442674000159218704749525744776015425445631936508514988284348011214403908811000524131480098004472360781543543480603009034487076187649548648274372120385359008488364250670349268581117022831259369137106792722496946590063104994785304656410351596217739087107112392942009049392125114366752695149528325983389945259869691403639841440394681076035203661200100894793773225075249853731905017632640601200205302833677010101642550894247827516643188218032612283244761239951526534188844562023293853636446388824852489280265439935468047078341809846669236696373721709749222309912797804619332236753427993659890767914369798943719071624310941065363913687315796030391619094199755458176600454242473544701112234791693021489037713356766284439584763539173865430882150560999619496776407674890032519303251820384796670885421748896436653239957450459896832450175320470630014894575257610023587987968467726802743789968485340301968279926032545956489560012715564345684039356706091548597621371743888946773173291536557072674379399085943829041276879563772116813476
bytes_ptxt = pow(ctxt, d, N).to_bytes(2048//8, "big")
ptxt = str(unpad(bytes_ptxt, 2048//8), "utf-8")
print(ptxt)
```
# Flag
```osu{d0n7_ch0O5e_pR1m3s_7h4t_R_5imIl4r}```
